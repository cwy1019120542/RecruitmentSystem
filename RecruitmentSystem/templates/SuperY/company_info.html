{% extends 'SuperY/company_base.html' %}
{% load staticfiles %}
{% block title %}
用户信息
{% endblock title %}
{% block content %}
    <div class="center">
        <div class='login_form register_form info_form'>
            <h4>企业名称 <span name="company_name_info"></span></h4>
            <input type='text' name="company_name" placeholder="请输入企业名称，不超过50字符" value={{user.company_name}}>
            <h4>企业性质 <span name="company_type_info"></span></h4>
            <input type='text' name="company_type" placeholder="请输入企业性质，不超过50字符" value={{user.company_type}}>
            <h4 class='tate-owned'>企业规模 <span name="staff_number_info"></span></h4>
            <input type='text' name="staff_number" placeholder="请输入企业规模，如500-1000人，不超过50个字符" value={{user.staff_number}}>
            <h4>企业地址 <span name="address_info"></span></h4>
            <input name="address" placeholder="请输入企业地址，不超过100个字符" type="text" value={{user.address}}>
            <h4>上传营业执照 <span name="business_licence_info"></span></h4>
            <label>
                <input type="button" name='pic_btn' value="选择图片"><span name="pic_text">
                    {{user.business_licence}}
                </span>
                <input type="file" name='business_licence' style="display:none;">
            </label>
            <h4>企业简介 <span name="company_info_info"></span></h4>
            <input type='text' name="company_info" placeholder="请输入企业简介" value={{user.company_info}}>
            <button name='save_btn'>保 存</button>
        </div>
    </div>
    <script src="{% static 'SuperY/js/jquery-3.2.1.min.js' %}"></script>
    <script>
    document.querySelector('[name="pic_btn"]').onclick=function() {
			document.querySelector('[name="business_licence"]').click();
		}
		var business_licence=document.querySelector('[name="business_licence"]');
		business_licence.onchange=function() {
			document.querySelector('[name="pic_text"]').innerHTML=business_licence.files[0].name;
		}
    document.querySelector('[name="save_btn"]').onclick = function() {
        var company_name = document.querySelector('[name="company_name"]').value;
        var company_type = document.querySelector('[name="company_type"]').value;
        var staff_number = document.querySelector('[name="staff_number"]').value;
        var address = document.querySelector('[name="address"]').value;
        var business_licence = document.querySelector('[name="business_licence"]').files[0];
        var company_info = document.querySelector('[name="company_info"]').value;
        var company_name_info = document.querySelector('[name="company_name_info"]');
        var company_type_info = document.querySelector('[name="company_type_info"]');
        var staff_number_info = document.querySelector('[name="staff_number_info"]');
        var address_info = document.querySelector('[name="address_info"]');
        var business_licence_info = document.querySelector('[name="business_licence_info"]');
        var company_info_info = document.querySelector('[name="company_info_info"]');
        var file_type=['jpg','JPG','png','PNG','gif','GIF']
        var is_post = true;
        company_name_info.innerHTML = '';
        company_type_info.innerHTML = '';
        staff_number_info.innerHTML = '';
        address_info.innerHTML = '';
        business_licence_info.innerHTML = '';
        company_info_info.innerHTML = '';
        if (!company_name) {
            is_post = false;
            company_name_info.innerHTML = "请您填写正确格式的企业名称";
        };
        if (!company_type) {
            is_post = false;
            company_type_info.innerHTML = "请您填写正确格式的企业性质";
        };
        if (!staff_number) {
            is_post = false;
            staff_number_info.innerHTML = "请您填写正确格式的企业规模";
        };
        if (!address) {
            is_post = false;
            address_info.innerHTML = "请您填写正确格式的企业地址";
        };
        if (!company_info) {
            is_post = false;
            company_info_info.innerHTML = "请您填写正确格式的企业简介";
        };
        if (business_licence && file_type.indexOf(business_licence.name.split('.')[1])==-1) {
            is_post=false;
            business_licence_info.innerHTML="请您上传正确格式的营业执照";
        }
        if (is_post) {
            var formData = new FormData();
            formData.append('company_name', company_name);
            formData.append('company_type', company_type);
            formData.append('staff_number', staff_number);
            formData.append('address', address);
            formData.append('business_licence', business_licence);
            formData.append('company_info', company_info);
            $.ajax({
                type: 'post',
                url: '{% url "SuperY:company_info_ajax" user.id %}',
                data: formData,
                processData: false,
                contentType: false,
                success: function(data) {
                    if (data) {
                        data=JSON.parse(data);
                        company_name_info.innerHTML=data.company_name_error;
                    }
                    else {
                        layer.alert('修改成功', {icon: 6, yes:function() {
                             window.location.replace('{% url "SuperY:company_index" user.id %}');
                        }});
                   
                    };
                }
            })
        }
    };
    </script>
{% endblock content %}