<!DOCTYPE html>
{% load staticfiles %}
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>企业认证</title>
	<link rel="stylesheet" href="{% static 'SuperY/css/main.css' %}">
	<link rel="shortcut icon" href="{% static 'SuperY/images/favicon.ico' %}" type="image/x-icon" />
</head>
<body>
		<div class='topNav'>
		<div class="topNav_c clearfix">
			<span>欢迎回来  {{user.person_name}}</span>
			<ul>
				<li>{{user.phone_number}}</li>
				<a href="{% url 'SuperY:company_logout' user.id %}"><li>注销</li></a>
			</ul>
		</div>
	</div>
<div class="center">
	<div class='login_form register_form'>
		{% csrf_token %}
		<h4>企业名称 <span name="company_name_info"></span></h4>
		<input type='text' name="company_name" placeholder="请输入企业名称，不超过50字符">
		<h4>企业性质 <span name="company_type_info"></span></h4>
		<input type="radio" name="company_type" value='国有企业' class='applicant'>国有企业
		<input type="radio" name="company_type" value='民营企业'class='bossRadio'>民营企业
		<input type="radio" name="company_type" value='外商独资企业'class='bossRadio'>外商独资企业
		<input type="radio" name="company_type" value='中外合资企业'class='bossRadio'>中外合资企业
		<input type="radio" name="company_type" value='创业公司'class='bossRadio'>创业公司
		<input type="radio" name="company_type" value='上市公司'class='bossRadio'>上市公司
		<input type="radio" name="company_type" value='其他'class='bossRadio'>其他
		<h4 class='tate-owned'>企业规模 <span name="staff_number_info"></span></h4>
		<input type='text' name="staff_number" placeholder="请输入企业规模，如500-1000人，不超过50个字符">
		<h4>企业地址 <span name="address_info"></span></h4>
		<input name="address" placeholder="请输入企业地址，不超过100个字符" type="text">
		<h4>上传营业执照 <span name="business_licence_info"></span></h4>
		<input type="file" name='business_licence'>
		<button name='check_btn'>认 证</button>
	</div>
</div>
<div class="bottom">我是底部</div>
	<script src="{% static 'SuperY/js/jquery-3.2.1.min.js' %}"></script>
	<script src="{% static 'SuperY/js/jquery.cookie.js' %}"></script>
	<script>
		 function csrfSafeMethod(method) {
        // these HTTP methods do not require CSRF protection
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }
    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", $.cookie("csrftoken"));
            }
        }
    });
		document.querySelector('[name="check_btn"]').onclick=function() {
		var company_name=document.querySelector('[name="company_name"]').value;
		var company_type=document.querySelector('[name="company_type"]:checked');
		var staff_number=document.querySelector('[name="staff_number"]').value;
		var address=document.querySelector('[name="address"]').value;
		var business_licence=document.querySelector('[name="business_licence"]').files[0];
		var company_name_info=document.querySelector('[name="company_name_info"]');
		var company_type_info=document.querySelector('[name="company_type_info"]');
		var staff_number_info=document.querySelector('[name="staff_number_info"]');
		var address_info=document.querySelector('[name="address_info"]');
		var business_licence_info=document.querySelector('[name="business_licence_info"]');
		var file_type=['jpg','JPG','png','PNG','gif','GIF']
		var is_post=true;
		company_name_info.innerHTML='';
		company_type_info.innerHTML='';
		staff_number_info.innerHTML='';
		address_info.innerHTML='';
		business_licence_info.innerHTML='';
		if (!company_name || company_name.length>50) {
			is_post=false;
			company_name_info.innerHTML="请您填写正确格式的公司名";
		}
		if (!company_type) {
			is_post=false;
			company_type_info.innerHTML="请您选择公司类型";
		}
		if (!staff_number || staff_number.length>50) {
			is_post=false;
			staff_number_info.innerHTML="请您填写正确格式的公司规模";
		}
		if (!address || address.length>100) {
			is_post=false;
			address_info.innerHTML="请您填写正确格式的地址";
		}
		if (!business_licence) {
			is_post=false;
			business_licence_info.innerHTML="请您上传营业执照";
		}
		if (business_licence && file_type.indexOf(business_licence.name.split('.')[1])==-1) {
            is_post=false;
            business_licence_info.innerHTML="请您上传正确格式的营业执照";
        }
		if (is_post){
			var formData=new FormData();
			formData.append('company_name',company_name);
			formData.append('company_type',company_type.value);
			formData.append('staff_number',staff_number);
			formData.append('address',address);
			formData.append('business_licence',business_licence);
			$.ajax({
				type:'post',
				url:'{% url "SuperY:company_check_ajax" user.id %}',
				data:formData,
				processData:false,
                contentType:false,
				success:function(data) {
					data=JSON.parse(data)
					if (data.company_name_error){
						company_name_info.innerHTML=data.company_name_error;
					}
					else {
						window.location.replace('{% url "SuperY:company_index" user.id %}');
					}
				}
			}) 
		}
	};
	</script>
</body>
</html>